{% assign locale = site.data.locales.en %}
{% if page.lang and page.lang == 'zh' %}
  {% assign locale = site.data.locales.zh %}
{% endif %}

<header class="site-header">
  <div class="container">
    <div class="header-content">
      <div class="site-branding">
        <a class="site-title" href="{% if page.lang == 'zh' %}/zh/{% else %}/{% endif %}">
          {{ locale.site.title | default: site.title }}
        </a>
      </div>

      <nav class="site-nav">
        <ul class="nav-menu">
          <li class="nav-item">
            <a class="nav-link" href="{% if page.lang == 'zh' %}/zh/{% else %}/{% endif %}">
              {{ locale.nav.home }}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% if page.lang == 'zh' %}/zh/about/{% else %}/about/{% endif %}">
              {{ locale.nav.about }}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% if page.lang == 'zh' %}/zh/posts/{% else %}/posts/{% endif %}">
              {{ locale.nav.posts }}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% if page.lang == 'zh' %}/zh/categories/{% else %}/categories/{% endif %}">
              {{ locale.nav.categories }}
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% if page.lang == 'zh' %}/zh/tags/{% else %}/tags/{% endif %}">
              {{ locale.nav.tags }}
            </a>
          </li>
        </ul>

        <div class="nav-controls">
          <!-- Language switcher -->
          <div class="language-switcher">
            <button class="lang-toggle" aria-label="{{ locale.nav.language }}">
              {% if page.lang == 'zh' %}中{% else %}EN{% endif %}
            </button>
            <div class="lang-dropdown">
              {% if page.lang == 'zh' %}
                {% assign english_url = page.url | replace: '/zh/', '/' %}
                <a href="{{ english_url }}" class="lang-option">English</a>
              {% else %}
                <a href="/zh{{ page.url }}" class="lang-option">中文</a>
              {% endif %}
            </div>
          </div>

          <!-- Search toggle -->
          <button class="search-toggle" aria-label="{{ locale.nav.search }}">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="M21 21l-4.35-4.35"/>
            </svg>
          </button>

          <!-- Theme toggle -->
          <button class="theme-toggle" aria-label="{{ locale.general.toggle_theme }}">
            <svg class="theme-icon theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <line x1="12" y1="1" x2="12" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="3" y2="12"/>
              <line x1="21" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
            <svg class="theme-icon theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
            </svg>
          </button>

          <!-- Mobile menu toggle -->
          <button class="mobile-menu-toggle" aria-label="Toggle menu">
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
          </button>
        </div>
      </nav>
    </div>

    <!-- Search overlay -->
    <div class="search-overlay">
      <div class="search-box">
        <input type="text" class="search-input" placeholder="{{ locale.search.placeholder }}">
        <button class="search-close" aria-label="Close search">×</button>
      </div>
      <div class="search-results">
        <div class="search-results-content"></div>
      </div>
    </div>
  </div>
</header>